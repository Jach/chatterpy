<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Chatterpy Chat</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<!-- color picker -->
<script type="text/javascript" src="/static/farbtastic.js"></script>
<link rel="stylesheet" href="/static/farbtastic.css" type="text/css"></script>

<link rel="stylesheet" href="/static/style.css" type="text/css" />
<script type="text/javascript">
var username = '{{ name }}'

var render_ui = function() {
  $('#sendformsubmit').height($('#messagetextholder').height())
  $('#sendformsubmit').click(post_message)
  $('#colorpickerholder').hide()
  $('#colorpicker').farbtastic('#fontcolor')
  $('#togglepicker').click(function(ev) {
      $('#colorpickerholder').toggle(500)
      $('html, body').animate({scrollTop: $('#togglepicker').offset().top }, 510)
  })
}

$(function () {
  render_ui()
  $.post('{{ base_url }}/check/name/', {username: username},
    function(r) {
      if (r.success) {
        start_chat()
      } else {
        login_prompt()
      }
    }, 'json')
  }
)

var login_prompt = function() {

}

var start_chat = function() {

}

var post_message = function(ev) {
  ev.preventDefault()
  $.post('{{ base_url }}/post/', {
      color: $('#fontcolor').val(),
      message: $('#messagetext').val()},
    function(r) {
      if (!r.success) {
      }
    }, 'json')
}

var last_message_id = -1
var check_messages = function() {
  $.post('{{ base_url }}/check_messages/', {last_id: last_message_id},
    function(r) {
      // r.messages
    }, 'json')
}

</script>
</head>
<body>
  <noscript><h1>Turn your scripts on, foo.</h1></noscript>

  <div id="appcontainer">

  <div id="usersbox">
  </div>

  <div id="messagebox">
  </div>

  <div id="sendbox">
    <form id="sendform">
      <div id="messagetextholder">
        <div id="username">
          Bob
        </div>
        <textarea name="messagetext" id="messagetext" rows="3"></textarea>
        <input type="submit" value="Send" id="sendformsubmit" />
      </div>
      <div id="colorpickerholder">
        <div id="colorpicker"></div>
        <input type="text" name="fontcolor" id="fontcolor" value="#000000" />
      </div>
    </form>
    <br />
    <button id="togglepicker">Font Color</button>
  </div>

  </div>

</body>
</html>
